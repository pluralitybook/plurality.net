---
pagination:
  data: homeLangs
  size: 1
  alias: pageLang
layout: home.njk
eleventyComputed:
  lang: "{{ pageLang }}"
  title: ""
permalink: "{% if pageLang == 'en' %}/{% else %}/{{ pageLang }}/{% endif %}"
---

{% set t = i18n[pageLang] %}
{% set readPrefix = "" %}
{% if translations[pageLang] %}
  {% set readPrefix = translations[pageLang].prefix %}
{% endif %}

{# ═══════ HERO ═══════ #}
<section class="hero" aria-labelledby="hero-title">
  <img src="/assets/images/logo-plurality.png" alt="Plurality logo" class="hero__logo" width="319" height="97">

  {# ═══════ LANG PICKER ═══════ #}
  {% if homeLangs | length > 1 %}
  <nav class="home-lang-bar" aria-label="Language">
    {% for hl in homeLangs %}
      {% if hl == pageLang %}
        <span class="home-lang-bar__current">{{ i18n[hl].lang_name }}</span>
      {% else %}
        <a href="{% if hl == 'en' %}/{% else %}/{{ hl }}/{% endif %}" class="home-lang-bar__link">{{ i18n[hl].lang_name }}</a>
      {% endif %}
    {% endfor %}
  </nav>
  {% endif %}

  <h1 id="hero-title" class="hero__title">
    <span class="c-r">P</span><span class="c-o">l</span><span class="c-g">u</span><span class="c-c">r</span><span class="c-w">a</span><span class="c-c">l</span><span class="c-g">i</span><span class="c-o">t</span><span class="c-r">y</span>
  </h1>

  <div class="hero__brand-line" aria-hidden="true">
    <span class="hero__brand-line-r"></span>
    <span class="hero__brand-line-o"></span>
    <span class="hero__brand-line-g"></span>
    <span class="hero__brand-line-c"></span>
    <span class="hero__brand-line-w"></span>
    <span class="hero__brand-line-c"></span>
    <span class="hero__brand-line-g"></span>
    <span class="hero__brand-line-o"></span>
    <span class="hero__brand-line-r"></span>
  </div>

  <p class="hero__subtitle">{{ t.subtitle }}</p>

  <p class="hero__authors">{{ t.authors }}</p>

  <div class="hero__sep"></div>

  <a href="{{ readPrefix }}/read/" class="hero__cta">
    {{ t.read_book }} <span class="hero__cta-arrow">&rarr;</span>
  </a>

  <div class="hero__scroll" aria-hidden="true" tabindex="-1">
    <span>{{ t.hero_scroll }}</span>
    <span class="hero__scroll-line"></span>
  </div>
</section>

{# ═══════ ABOUT ═══════ #}
<section id="about" class="about-section section">
  <div class="about-section__inner">
    <p class="section-label reveal">{{ t.section_about }}</p>
    <h2 class="reveal">{{ t.about_heading }}</h2>
    <p class="reveal">{{ t.about_p1 }}</p>
    <p class="reveal">{{ t.about_p2 }}</p>
    <p class="reveal">{{ t.about_p3 }}</p>
  </div>
</section>

<div class="gold-sep"></div>

{# ═══════ GET THE BOOK ═══════ #}
{% set dl = downloads[pageLang] %}
<section class="get-book-section section section--warm">
  <div class="content-wrap">
    <div class="get-book reveal">
      <div class="get-book__cover">
        <img src="/assets/images/bookcover_small.png" alt="Plurality book cover" class="get-book__img">
      </div>
      <div class="get-book__info">
        <p class="section-label">{{ t.get_book }}</p>
        <h2>{{ t.get_book_heading }}</h2>
        <p>{{ t.get_book_desc }}</p>

        {# ── Primary links: Read / PDF / ePub ── #}
        <div class="get-book__links">
          <a href="{{ readPrefix }}/read/1/" class="involved-link">{{ t.read_online }} &rarr;</a>
          {% if dl and dl.pdf %}
            <a href="{{ dl.pdf }}" class="involved-link" target="_blank" rel="noopener">{{ t.download_pdf }} &rarr;</a>
          {% endif %}
          {% if dl and dl.epub %}
            <a href="{{ dl.epub }}" class="involved-link" target="_blank" rel="noopener">{{ t.download_epub }} &rarr;</a>
          {% endif %}
        </div>

        {# ── Purchase links (from downloads.json if available, else generic Amazon) ── #}
        {% if dl and dl.purchase and dl.purchase | length %}
        <div class="get-book__links get-book__links--purchase">
          {% for item in dl.purchase %}
            <a href="{{ item.url }}" class="involved-link" target="_blank" rel="noopener">{{ item.label }} &rarr;</a>
          {% endfor %}
        </div>
        {% else %}
        <div class="get-book__links get-book__links--purchase">
          <a href="https://www.amazon.com/dp/B0D24N776G" class="involved-link" target="_blank" rel="noopener">{{ t.buy_amazon }} &rarr;</a>
        </div>
        {% endif %}

        {# ── Audiobook (progressive disclosure) ── #}
        {% if dl and dl.audiobook %}
        <details class="get-book__audiobook">
          <summary class="get-book__audiobook-toggle">
            <span>{{ t.audiobook }}</span>
            <span class="get-book__audiobook-arrow"></span>
          </summary>
          <div class="get-book__audiobook-body">
            {% if dl.audiobook.full %}
            <a href="{{ dl.audiobook.full }}" class="get-book__audiobook-full involved-link" target="_blank" rel="noopener">
              {{ t.audiobook_full }} &rarr;
            </a>
            {% endif %}
            {% if dl.audiobook.parts and dl.audiobook.parts | length %}
            <p class="get-book__audiobook-parts-label">{{ t.audiobook_parts }}</p>
            <div class="get-book__audiobook-parts">
              {% for part in dl.audiobook.parts %}
                <a href="{{ part.url }}" class="get-book__audiobook-part" target="_blank" rel="noopener">{{ part.label }}</a>
              {% endfor %}
            </div>
            {% endif %}
          </div>
        </details>
        {% endif %}

        {# ── Extra resources (e.g. Japanese special site) ── #}
        {% if t.extra_resources %}
        <div class="get-book__extra">
          {% for res in t.extra_resources %}
          <div class="get-book__extra-item">
            <p>{{ res.desc }}</p>
            <a href="{{ res.url }}" class="involved-link" target="_blank" rel="noopener">{{ res.label }} &rarr;</a>
          </div>
          {% endfor %}
        </div>
        {% endif %}

        {# ── Donation ── #}
        <div class="get-book__extra">
          <h2>{{ t.donate_heading }}</h2>
          <p>{{ t.donate_desc }}</p>
          <div class="get-book__extra-item">
              <a href="https://www.paypal.com/donate/?hosted_button_id=3Q6BS9ZA595ZS" class="involved-link" target="_blank" >{{ t.donate_paypal }} &rarr;</a>
              <a href="https://commerce.coinbase.com/checkout/aab4f708-439b-47ac-a68b-adf0613747bd" class="involved-link" target="_blank" >{{ t.donate_coinbase }} &rarr;</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="gold-sep"></div>

{# ═══════ CHAPTERS ═══════ #}
<section class="chapters-section section">
  <div class="content-wrap">
    <p class="section-label reveal">{{ t.section_chapters }}</p>
    <h2 class="reveal">{{ t.chapters_heading }}</h2>

    <div class="chapter-groups">
      {% for section in chapters.sections %}
        <div class="chapter-group reveal">
          <h3 class="chapter-group__title">
            <span class="chapter-group__accent" style="background:{{ section.color }}"></span>
            {% if t.sections %}{{ t.sections[section.title] or section.title }}{% else %}{{ section.title }}{% endif %}
          </h3>
          <div class="chapter-list">
            {% for ch in section.chapters %}
              {% if pageLang != "en" and translations[pageLang] and translations[pageLang].files[ch.id] %}
                <a href="{{ readPrefix }}/read/{{ ch.id }}/" class="chapter-card reveal" style="border-top-color:{{ section.color }}">
                  <span class="chapter-card__number">{{ ch.number }}</span>
                  <span class="chapter-card__title">{{ translations[pageLang].files[ch.id].title }}</span>
                </a>
              {% else %}
                <a href="{{ readPrefix }}/read/{{ ch.id }}/" class="chapter-card reveal" style="border-top-color:{{ section.color }}">
                  <span class="chapter-card__number">{{ ch.number }}</span>
                  <span class="chapter-card__title">{{ ch.title }}</span>
                </a>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</section>

{# ═══════ ENDORSEMENTS (if language has endorsements data or 0-0 chapter) ═══════ #}
{% set hasEndorsements = (pageLang == "en") or endorsements[pageLang] or (translations[pageLang] and translations[pageLang].files["0-0"]) %}
{% if hasEndorsements %}
<div class="gold-sep"></div>

<section class="endorsements-section section">
  <div class="content-wrap">
    <p class="section-label reveal">{{ t.section_endorsements }}</p>
    <h2 class="reveal">{{ t.endorsements_heading }}</h2>

    {% set langEndorsements = endorsements[pageLang] or endorsements.en %}
    <div class="endorsement-grid">
      {% for item in langEndorsements | slice(0, 3) %}
        <div class="endorsement-card reveal">
          <span class="endorsement-card__quote-mark" aria-hidden="true">&ldquo;</span>
          <p class="endorsement-card__text">{{ item.quote }}</p>
          <p class="endorsement-card__author">{{ item.author }}</p>
          {% if item.title %}<p class="endorsement-card__role">{{ item.title }}</p>{% endif %}
        </div>
      {% endfor %}
    </div>

    {% if translations[pageLang] and translations[pageLang].files["0-0"] %}
    <div class="section__view-all">
      <a href="{{ readPrefix }}/read/0-0/" class="involved-link reveal">
        {{ t.view_all_endorsements }} &rarr;
      </a>
    </div>
    {% elif pageLang == "en" %}
    <div class="section__view-all">
      <a href="/read/0-0/" class="involved-link reveal">
        {{ t.view_all_endorsements }} &rarr;
      </a>
    </div>
    {% endif %}
  </div>
</section>
{% endif %}

<div class="gold-sep"></div>

{# ═══════ GET INVOLVED ═══════ #}
<section class="involved-section section">
  <div class="content-wrap">
    <p class="section-label reveal">{{ t.section_get_involved }}</p>
    <h2 class="reveal">{{ t.involved_heading }}</h2>
    <p class="reveal">{{ t.involved_desc }}</p>

    <div class="involved-links">
      <a href="{{ site.github }}" class="involved-link reveal" target="_blank" rel="noopener">
        {{ t.contribute }} &rarr;
      </a>
      <a href="{{ site.discord }}" class="involved-link reveal" target="_blank" rel="noopener">
        {{ t.join_discord }} &rarr;
      </a>
      <a href="{{ readPrefix }}/read/" class="involved-link reveal">
        {{ t.start_reading }} &rarr;
      </a>
    </div>
  </div>
</section>
